<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø³ÙˆÙ‚ Ø¹Ø²Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„Ø© ğŸ”</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --primary: #004d40; --orange: #ff6d00; --bg: #f0f4f7; --red: #d32f2f; --green-click: #2ecc71; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); margin: 0; padding: 20px; direction: rtl; }
        .container { max-width: 600px; margin: auto; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #adminAuth { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: white; padding: 30px; border-radius: 25px; text-align: center; width: 85%; max-width: 350px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); }

        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 5px solid var(--primary); }
        .contest-card { border-top-color: var(--orange); background: #fffcf0; }
        
        h2 { font-weight: 900; color: var(--primary); text-align: center; margin-top: 0; font-size: 1.3rem; }
        label { font-weight: 700; display: block; margin-top: 12px; color: #555; font-size: 0.85rem; }
        
        input, select, textarea { width: 100%; padding: 12px; margin-top: 8px; border-radius: 12px; border: 1.5px solid #eee; font-family: 'Tajawal'; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--primary); }

        .btn-main { width: 100%; padding: 15px; margin-top: 15px; border-radius: 12px; border: none; background: var(--primary); color: white; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-main:active { transform: scale(0.97); }

        /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª */
        .store-item { background: white; padding: 12px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .btn-del { background: #ffebee; color: var(--red); padding: 5px 10px; border-radius: 8px; border: none; font-size: 0.7rem; font-weight: 700; cursor: pointer; }

        /* ØªØµÙ…ÙŠÙ… Ù…Ø±Ø¨Ø¹ Ø§Ù„ÙƒÙˆØ¯ (Ø£Ø®Ø¶Ø± ÙˆÙ†Ù‚Ø± Ø£Ø³ÙˆØ¯) */
        .code-box { 
            background: #e8f5e9; 
            color: #81c784; 
            padding: 10px 12px; 
            border-radius: 10px; 
            font-family: monospace; 
            font-weight: 900; 
            cursor: pointer; 
            min-width: 110px;
            text-align: center;
            border: 2px solid #c8e6c9;
            transition: 0.3s;
            user-select: none;
        }
        /* Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± (ØªÙØ¹ÙŠÙ„ Ù…Ù† JS) */
        .code-box.active-code { 
            background: var(--green-click) !important; 
            color: #000000 !important; 
            border-color: #27ae60 !important;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }

        /* ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø¯ÙŠØ« */
        #toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 50px; z-index: 10000; transition: 0.5s; font-weight: 700; color: white; text-align: center; }
    </style>
</head>
<body>

<audio id="waterSnd"><source src="https://www.soundjay.com/nature/sounds/water-droplet-1.mp3"></audio>
<div id="toast"></div>

<div id="adminAuth">
    <div class="auth-card">
        <div style="font-size: 3.5rem; margin-bottom: 10px;">ğŸ”</div>
        <h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        <input type="password" id="adminPass" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ">
        <button class="btn-main" onclick="checkAuth()">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div class="container" id="adminPanel" style="display:none;">
    
    <div class="card contest-card">
        <h2 style="color: var(--orange);">ğŸŒ™ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ù…Ø¶Ø§Ù†</h2>
        <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label>
        <select id="cStatus" onchange="playWater()">
            <option value="off">âŒ Ø¥Ø®ÙØ§Ø¡</option>
            <option value="on">âœ… Ø¥Ø¸Ù‡Ø§Ø±</option>
        </select>
        <label>Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label>
        <textarea id="cQuestion" rows="2" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„..."></textarea>
        <label>Ø­Ø§Ù„Ø© Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø²:</label>
        <select id="winStatus" onchange="playWater()">
            <option value="off">âŒ Ù…Ø®ÙÙŠ</option>
            <option value="on">âœ… Ø¸Ø§Ù‡Ø±</option>
        </select>
        <label>Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø²:</label>
        <input type="text" id="cWinner" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø²">
        <button class="btn-main" style="background:var(--orange)" onclick="saveContest()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€</button>
    </div>

    <div class="card">
        <h2>ğŸª Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="storeName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
        <input type="text" id="storePhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
        <label>ÙØ¦Ø© Ø§Ù„Ù…Ø­Ù„:</label>
        <select id="storeCat">
            <option value="Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©">Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©</option>
            <option value="Ù…Ø·Ø§Ø¹Ù… ÙˆÙƒÙØªÙŠØ±ÙŠØ§">Ù…Ø·Ø§Ø¹Ù… ÙˆÙƒÙØªÙŠØ±ÙŠØ§</option>
            <option value="Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡ ÙˆØ³Ø¨Ø§ÙƒØ©">Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡ ÙˆØ³Ø¨Ø§ÙƒØ©</option>
            <option value="Ù…ÙˆØ§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡">Ù…ÙˆØ§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
            <option value="Ø³Ù„Ø¹ Ù…ØªÙ†ÙˆØ¹Ø© ÙˆØ£Ø®Ø±Ù‰">Ø³Ù„Ø¹ Ù…ØªÙ†ÙˆØ¹Ø© ÙˆØ£Ø®Ø±Ù‰</option>
        </select>
        <button class="btn-main" onclick="addStore()">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ âœ…</button>
    </div>

    <div class="card">
        <h2>ğŸ“‹ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª</h2>
        <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ù„..." onkeyup="filterStores()">
        <div id="storesList" style="margin-top: 15px;"></div>
    </div>
</div>

<script>
    const ADMIN_KEY = "123456"; 
    const firebaseConfig = { databaseURL: "https://souq-tarim-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function playWater() { 
        const s = document.getElementById('waterSnd');
        s.currentTime = 0; s.play().catch(()=>{}); 
    }

    function showToast(msg, bgColor = "#333") {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.background = bgColor;
        t.style.top = "30px";
        setTimeout(() => { t.style.top = "-100px"; }, 3000);
    }

    function checkAuth() {
        const pass = document.getElementById('adminPass').value;
        if(pass === ADMIN_KEY) {
            playWater();
            document.getElementById('adminAuth').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            syncData();
        } else {
            playWater();
            showToast("âŒ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­!", "#d32f2f");
            document.getElementById('adminPass').value = "";
        }
    }

    function syncData() {
        db.ref('RamadanContest').on('value', snap => {
            const d = snap.val();
            if(d) {
                document.getElementById('cStatus').value = d.status || 'off';
                document.getElementById('cQuestion').value = d.question || '';
                document.getElementById('cWinner').value = d.winner || '';
                document.getElementById('winStatus').value = d.winStatus || 'off';
            }
        });
        loadStores();
    }

    function addStore() {
        const name = document.getElementById('storeName').value;
        const phone = document.getElementById('storePhone').value;
        const cat = document.getElementById('storeCat').value;
        if(!name || !phone) return showToast("âš ï¸ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "#ff6d00");

        playWater();
        const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
        let p1 = ""; let p2 = "";
        for(let i=0; i<3; i++) p1 += chars.charAt(Math.floor(Math.random() * chars.length));
        for(let i=0; i<3; i++) p2 += chars.charAt(Math.floor(Math.random() * chars.length));
        const code = "AZ-" + p1 + "-" + p2 + "-" + Math.floor(100 + Math.random() * 899);

        db.ref('Stores/' + code).set({ name, phone, category: cat }).then(() => {
            showToast("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© " + name, "#004d40");
            document.getElementById('storeName').value = "";
            document.getElementById('storePhone').value = "";
        });
    }

    function loadStores() {
        db.ref('Stores').on('value', snap => {
            const list = document.getElementById('storesList');
            list.innerHTML = "";
            const data = snap.val();
            if(!data) return;
            Object.keys(data).forEach(id => {
                list.innerHTML += `
                    <div class="store-item" data-name="${data[id].name}">
                        <div>
                            <b>${data[id].name}</b><br>
                            <small style="color:#777">${data[id].category || ''}</small><br>
                            <button class="btn-del" onclick="deleteStore('${id}')">Ø­Ø°Ù</button>
                        </div>
                        <div class="code-box" onclick="handleCodeClick(this, '${id}')">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</div>
                    </div>`;
            });
        });
    }

    function handleCodeClick(el, code) {
        playWater();
        navigator.clipboard.writeText(code);
        
        // ØªØºÙŠÙŠØ± Ø§Ù„Ø´ÙƒÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
        el.innerText = code;
        el.classList.add('active-code');
        showToast("ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯: " + code, "#2ecc71");

        // Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ 2.5 Ø«Ø§Ù†ÙŠØ©
        setTimeout(() => {
            el.innerText = "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢";
            el.classList.remove('active-code');
        }, 2500);
    }

    function saveContest() {
        playWater();
        db.ref('RamadanContest').update({
            status: document.getElementById('cStatus').value,
            question: document.getElementById('cQuestion').value,
            winner: document.getElementById('cWinner').value,
            winStatus: document.getElementById('winStatus').value 
        }).then(() => showToast("ğŸš€ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©", "#ff6d00"));
    }

    function deleteStore(id) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ØŸ")) { playWater(); db.ref('Stores/' + id).remove(); }
    }

    function filterStores() {
        const val = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('.store-item').forEach(item => {
            item.style.display = item.dataset.name.toLowerCase().includes(val) ? "flex" : "none";
        });
    }
</script>
</body>
</html>