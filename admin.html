<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø³ÙˆÙ‚ Ø¹Ø²Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„Ø© ğŸ”</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --primary: #004d40; --orange: #ff6d00; --bg: #f0f4f7; --red: #d32f2f; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); margin: 0; padding: 20px; direction: rtl; }
        .container { max-width: 600px; margin: auto; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #adminAuth { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: white; padding: 30px; border-radius: 25px; text-align: center; width: 85%; max-width: 350px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); }

        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 5px solid var(--primary); position: relative; }
        .contest-card { border-top-color: var(--orange); background: #fffcf0; }
        
        h2 { font-weight: 900; color: var(--primary); text-align: center; margin-top: 0; font-size: 1.4rem; }
        label { font-weight: 700; display: block; margin-top: 15px; color: #555; font-size: 0.9rem; }
        
        input, select, textarea { width: 100%; padding: 14px; margin-top: 8px; border-radius: 12px; border: 1.5px solid #eee; font-family: 'Tajawal'; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus, textarea:focus { border-color: var(--primary); }

        .btn-main { width: 100%; padding: 16px; margin-top: 15px; border-radius: 12px; border: none; background: var(--primary); color: white; font-weight: 800; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-main:active { transform: scale(0.96); }
        .btn-orange { background: var(--orange); }

        /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª */
        .store-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 12px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; }
        .store-info b { color: var(--primary); font-size: 1.1rem; }
        .store-actions { display: flex; gap: 8px; margin-top: 8px; }
        .btn-small { padding: 6px 12px; border-radius: 8px; border: none; font-size: 0.75rem; font-weight: 700; cursor: pointer; }
        .btn-del { background: #ffebee; color: var(--red); }
        .btn-copy { background: #e8f5e9; color: #2e7d32; }

        /* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù†Ø¬Ø§Ø­ */
        #toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 25px; border-radius: 50px; z-index: 10000; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); font-weight: 700; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div id="toast">âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­</div>

<div id="adminAuth">
    <div class="auth-card">
        <div style="font-size: 4rem; margin-bottom: 10px;">ğŸ”</div>
        <h3 style="margin: 0 0 20px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        <input type="password" id="adminPass" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ">
        <button class="btn-main" onclick="checkAuth()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù„ÙˆØ­Ø©</button>
    </div>
</div>

<div class="container" id="adminPanel" style="display:none;">
    
    <div class="card contest-card">
        <h2 style="color: var(--orange);">ğŸŒ™ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ù…Ø¶Ø§Ù†</h2>
        
        <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</label>
        <select id="cStatus">
            <option value="off">âŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (ØªØ¹Ø·ÙŠÙ„)</option>
            <option value="on">âœ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (ØªÙØ¹ÙŠÙ„)</option>
        </select>

        <label>Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label>
        <textarea id="cQuestion" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø§Ù„ÙŠÙˆÙ… Ù‡Ù†Ø§..."></textarea>
        
        <label>Ø­Ø§Ù„Ø© Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø²:</label>
        <select id="winStatus">
            <option value="off">âŒ Ù…Ø³Ø·ÙˆØ± (Ù…Ø®ÙÙŠ)</option>
            <option value="on">âœ… Ù…ÙØªÙˆØ­ (Ø¸Ø§Ù‡Ø±)</option>
        </select>

        <label>Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø² Ø§Ù„Ù…Ø­Ø¸ÙˆØ¸:</label>
        <input type="text" id="cWinner" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø²">

        <button class="btn-main btn-orange" onclick="saveContest()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¢Ù† ğŸš€</button>
    </div>

    <div class="card">
        <h2>ğŸª Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ (ØªØ§Ø¬Ø±) Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="storeName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
        <input type="text" id="storePhone" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø­Ù„">
        <select id="storeCat">
            <option value="Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©">Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©</option>
            <option value="Ù…Ø·Ø§Ø¹Ù… ÙˆÙƒÙØªÙŠØ±ÙŠØ§">Ù…Ø·Ø§Ø¹Ù… ÙˆÙƒÙØªÙŠØ±ÙŠØ§</option>
            <option value="Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡ ÙˆØ³Ø¨Ø§ÙƒØ©">Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡ ÙˆØ³Ø¨Ø§ÙƒØ©</option>
            <option value="Ù…ÙˆØ§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡">Ù…ÙˆØ§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
            <option value="Ø³Ù„Ø¹ Ù…ØªÙ†ÙˆØ¹Ø© ÙˆØ£Ø®Ø±Ù‰">Ø³Ù„Ø¹ Ù…ØªÙ†ÙˆØ¹Ø© ÙˆØ£Ø®Ø±Ù‰</option>
        </select>
        <button class="btn-main" onclick="addStore()">ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ§Ù„Ù†Ø´Ø± âœ…</button>
    </div>

    <div class="card">
        <h2>ğŸ“‹ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯</h2>
        <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ù„..." onkeyup="filterStores()">
        <div id="storesList" style="margin-top: 20px;"></div>
    </div>

</div>

<script>
    const ADMIN_KEY = "123456"; 
    const firebaseConfig = { databaseURL: "https://souq-tarim-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function showToast(msg, bg="#333") {
        const t = document.getElementById('toast');
        t.innerText = msg; t.style.background = bg;
        t.style.top = "30px";
        setTimeout(() => { t.style.top = "-100px"; }, 3000);
    }

    function checkAuth() {
        if(document.getElementById('adminPass').value === ADMIN_KEY) {
            document.getElementById('adminAuth').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            syncData();
        } else { alert("Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­!"); }
    }

    function syncData() {
        db.ref('RamadanContest').on('value', snap => {
            const d = snap.val();
            if(d) {
                document.getElementById('cStatus').value = d.status || 'off';
                document.getElementById('cQuestion').value = d.question || '';
                document.getElementById('cWinner').value = d.winner || '';
                document.getElementById('winStatus').value = d.winStatus || 'off';
            }
        });
        loadStores();
    }

    function saveContest() {
        db.ref('RamadanContest').update({
            status: document.getElementById('cStatus').value,
            question: document.getElementById('cQuestion').value,
            winner: document.getElementById('cWinner').value,
            winStatus: document.getElementById('winStatus').value 
        }).then(() => showToast("ğŸš€ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­", "var(--orange)"));
    }

    function addStore() {
        const name = document.getElementById('storeName').value;
        const phone = document.getElementById('storePhone').value;
        const cat = document.getElementById('storeCat').value;
        if(!name || !phone) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const code = "AZ-" + Math.floor(1000 + Math.random() * 9000);
        db.ref('Stores/' + code).set({ name, phone, category: cat }).then(() => {
            showToast("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ù„ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯");
            document.getElementById('storeName').value = "";
            document.getElementById('storePhone').value = "";
        });
    }

    function loadStores() {
        db.ref('Stores').on('value', snap => {
            const list = document.getElementById('storesList');
            list.innerHTML = "";
            const data = snap.val();
            if(!data) return list.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹";
            
            Object.keys(data).forEach(id => {
                list.innerHTML += `
                    <div class="store-item" data-name="${data[id].name}">
                        <div class="store-info">
                            <b>${data[id].name}</b><br>
                            <small>${data[id].category}</small>
                            <div class="store-actions">
                                <button class="btn-small btn-copy" onclick="copyCode('${id}')">Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                                <button class="btn-small btn-del" onclick="deleteStore('${id}')">Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <div style="text-align:left; font-weight:900; color:var(--primary); font-family:monospace;">${id}</div>
                    </div>`;
            });
        });
    }

    function copyCode(code) {
        navigator.clipboard.writeText(code);
        showToast("ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯: " + code);
    }

    function deleteStore(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¹Ø±ÙˆØ¶Ù‡ Ø£ÙŠØ¶Ø§Ù‹!")) {
            db.ref('Stores/' + id).remove();
            db.ref('Products/' + id).remove();
            showToast("ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„");
        }
    }

    function filterStores() {
        const val = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('.store-item').forEach(item => {
            item.style.display = item.dataset.name.toLowerCase().includes(val) ? "flex" : "none";
        });
    }
</script>
</body>
</html>